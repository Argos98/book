<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Telegram Bots in .NET</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="Introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><a href="FAQ.html"><strong aria-hidden="true">2.</strong> FAQ</a></li><li><a href="intro.html"><strong aria-hidden="true">3.</strong> Overview</a></li><li><a href="quickstart.html"><strong aria-hidden="true">4.</strong> Quickstart</a></li><li><a href="Working-Behind-a-Proxy.html"><strong aria-hidden="true">5.</strong> Working behind a proxy</a></li><li><a href="Authorization-Token.html"><strong aria-hidden="true">6.</strong> Authorization token</a></li><li><a href="Sending-Messages.html"><strong aria-hidden="true">7.</strong> Sending messages</a></li><li><a href="Sending-Files.html"><strong aria-hidden="true">8.</strong> Sending files</a></li><li><a href="Migration-Guide-to-Version-14.x.html"><strong aria-hidden="true">9.</strong> Migration guide =&gt; v14</a></li><li><a href="Getting-Updates.html"><strong aria-hidden="true">10.</strong> Getting updates</a></li><li><a href="Example-Hello-Bot.html"><strong aria-hidden="true">11.</strong> Example 'hello' bot</a></li><li><a href="Deploying-Your-Bot.html"><strong aria-hidden="true">12.</strong> Deploying your bot</a></li><li><a href="Examples-from-Test-Cases.html"><strong aria-hidden="true">13.</strong> Examples from test cases</a></li><li><a href="Integration-Tests.html"><strong aria-hidden="true">14.</strong> Integration tests</a></li><li><a href="Login-Widget.html"><strong aria-hidden="true">15.</strong> Login widget</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Telegram Bots in .NET</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p>This library is a C# implementation of <a href="https://core.telegram.org/bots/api">Telegram Bot API</a>.</p>
<p>It is available as a <a href="https://www.nuget.org/packages/Telegram.Bot/">Telegram.Bot</a> nuget package.</p>
<p>Before you continue reading, make sure you read the <a href="https://core.telegram.org/bots"><code>Bots: An introduction for developers</code></a> guide by Telegram.
The article should provide you with the basic knowledge of what Telegram bots are and what they <a href="https://core.telegram.org/bots#4-how-are-bots-different-from-humans">can (or can't)</a> do.</p>
<a class="header" href="#getting-started" id="getting-started"><h2>Getting started</h2></a>
<a class="header" href="#prerequisites" id="prerequisites"><h3>Prerequisites</h3></a>
<p>There are three things you need to get started with making your very own bot:</p>
<ul>
<li><a href="https://core.telegram.org/bots">Basic documentation</a></li>
<li><a href="https://core.telegram.org/bots/api">Advanced documentation</a></li>
<li><a href="Authorization-Token.html">An authorization token</a></li>
</ul>
<a class="header" href="#telegrambotclient" id="telegrambotclient"><h3>TelegramBotClient</h3></a>
<p>At the core of the <code>Telegram.Bot</code> library is the <code>TelegramBotClient</code> class.</p>
<p>It encapsulates the control over your bot in an easy-to-use set of methods.</p>
<pre><code class="language-csharp">static readonly TelegramBotClient Bot = new TelegramBotClient(&quot;API Token&quot;);
</code></pre>
<p>All interaction with the bot api will be done through this class.</p>
<p>Try to reuse the <code>TelegramBotClient</code> instance, as it encapsulates an <code>HttpClient</code>.</p>
<p>There are two main things this class will help you with:</p>
<ul>
<li><a href="Getting-Updates.html">Getting updates</a></li>
<li><a href="Sending-Messages.html">Sending messages</a></li>
</ul>
<a class="header" href="#example" id="example"><h3>Example</h3></a>
<p>Take a look at the <a href="Example-Hello-Bot.html">Example Hello Bot</a>, that goes over the basics of making a bot.</p>
<p>You might also find an example <a href="https://github.com/TelegramBots/Telegram.Bot.Examples/blob/master/Telegram.Bot.Examples.Echo/Program.cs">echo bot</a> helpful.</p>
<a class="header" href="#getting-help" id="getting-help"><h2>Getting help</h2></a>
<p>If you encounter a problem, don't panic!</p>
<p>First, <em>please</em> consult the <a href="https://core.telegram.org/bots">documentation</a>. Most of the time the solution is hidden right there.</p>
<p>If you can't find an answer there, check out the <a href="FAQ.html">FAQ</a>. Odds are, someone else already had a similar question.</p>
<p>If that fails, feel free to join our <a href="https://t.me/joinchat/B35YY0QbLfd034CFnvCtCA">Group Chat</a> on Telegram, and ask any questions you might have there.
Remember, <a href="http://sol.gfxile.net/dontask.html">don't ask to ask, just ask</a>.</p>
<p>If you believe you found a bug, or you have a feature request, feel free to open an <a href="https://github.com/TelegramBots/Telegram.Bot/issues">issue</a> on <a href="https://github.com/TelegramBots/Telegram.Bot">GitHub</a>.
If you'd like, you can also open a <a href="https://github.com/TelegramBots/Telegram.Bot/pulls">pull request</a>, but read the <a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/CONTRIBUTING.md">contributing guidelines</a> first.</p>
<a class="header" href="#how-do-i-use-an-httpsocks-proxy" id="how-do-i-use-an-httpsocks-proxy"><h3>How do I use an HTTP/Socks proxy?</h3></a>
<p>Look at the wiki page: <a href="Working-Behind-a-Proxy.html">Working Behind a Proxy</a>.</p>
<a class="header" href="#i-got-a-409-error-what-do-i-do" id="i-got-a-409-error-what-do-i-do"><h3>I got a '409' error. What do I do?</h3></a>
<p>You are trying to receive updates multiple times at the same time. Either you are calling GetUpdates from two instances of the bot, or you are calling GetUpdates while a web hook is already set. That is not supported by the API, only receive on one instance.</p>
<a class="header" href="#how-do-i-get-the-user-id-from-a-username" id="how-do-i-get-the-user-id-from-a-username"><h3>How do I get the user id from a username?</h3></a>
<p>There is no way to do that with the API directly.
You could store a list of known usernames, mapped to ids.
This is <em>not</em> recommended, because usernames can be changed.</p>
<a class="header" href="#i-am-not-receiving-updates-from-channels" id="i-am-not-receiving-updates-from-channels"><h3>I am not receiving updates from channels.</h3></a>
<p>If you are using polling, you will have to subscribe to the <code>OnUpdate</code> event.
Check the <code>UpdateType</code> of the <code>Update</code>. If it is <code>UpdateType.ChannelPost</code> then the <code>Update.ChannelPost</code> property will be set.</p>
<a class="header" href="#this-faq-doesnt-have-my-question-on-it-where-can-i-get-my-torch-and-pitchfork" id="this-faq-doesnt-have-my-question-on-it-where-can-i-get-my-torch-and-pitchfork"><h3>This FAQ doesn't have my question on it. Where can I get my torch and pitchfork?</h3></a>
<p>Feel free to let us know in the <a href="https://t.me/joinchat/B35YY0QbLfd034CFnvCtCA">public group chat</a>.</p>
<a class="header" href="#introduction" id="introduction"><h1>Introduction</h1></a>
<p><strong>Telegram.Bot</strong> is the most popular .NET Client for <a href="https://core.telegram.org/bots/api">Telegram Bot API</a>. The Bot API is an HTTP-based interface created for developers keen on building bots for Telegram.</p>
<p><a href="https://www.telegram.org"><img src="./docs/tg-logo.png" alt="Telegram Logo" /></a></p>
<p>All the Bot API methods are already documented by Telegram<sup class="footnote-reference"><a href="#1">1</a></sup> but this guide covers all you need to create a chat bot in .NET and there are many concrete examples written in C#.</p>
<hr />
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://core.telegram.org/bots/api">Telegram Bot API</a></p>
</div>
<a class="header" href="#quickstart" id="quickstart"><h1>Quickstart</h1></a>
<a class="header" href="#bot-father" id="bot-father"><h2>Bot Father</h2></a>
<p>Before you start developing a bot, you need to talk to <a href="https://t.me/botfather">Bot Father <code>@botfather</code></a> on Telegram. Register a bot with him and get an access token. Access token is a secret key used to identify and authorize your bot in API requests. It looks like this:</p>
<pre><code class="language-text">123456789:AAE5cvFhxQ9C7vFGElcpMTNrYrkl3OBFo45
</code></pre>
<p><img src="./docs/bot-father.jpg" alt="Bot Father" /></p>
<a class="header" href="#hello-world" id="hello-world"><h2>Hello World</h2></a>
<p>Now you have a bot, it's time to bring it to life! Create a new console project for your bot. It could be a .NET Core project or a .NET project targeting versions 4.5+.</p>
<blockquote>
<p>This guide uses .NET Core examples but full .NET framework projects work as well.</p>
</blockquote>
<pre><code class="language-bash">dotnet new console
</code></pre>
<p>Add a reference to <code>Telegram.Bot</code> package.</p>
<pre><code class="language-bash">dotnet add package Telegram.Bot
</code></pre>
<p>Open <code>Program.cs</code> file and use the following content. Replace <code>YOUR_ACCESS_TOKEN_HERE</code> with the access token from Bot Father.</p>
<pre><code class="language-c#">using System;
using Telegram.Bot;

namespace Awesome {
  class Program {
    static void Main() {
      var botClient = new TelegramBotClient(&quot;YOUR_ACCESS_TOKEN_HERE&quot;);
      var me = botClient.GetMeAsync().Result;
      Console.WriteLine(
        $&quot;Hello, World! I am user {me.Id} and my name is {me.FirstName}.&quot;
      );
    }
  }
}
</code></pre>
<p>Running the program gives you the following output:</p>
<pre><code class="language-bash">dotnet run
</code></pre>
<pre><code class="language-text">Hello, World! I am user 123456789 and my name is Awesome Bot.
</code></pre>
<p>Note that some countries (namely Iran) are blocking http and socks proxies from connecting to Telegram.
If you live in such a country, consider using a VPN, Tor or moving the hosting to another country/cloud.</p>
<a class="header" href="#http-proxy" id="http-proxy"><h2>HTTP Proxy</h2></a>
<p>The <code>TelegramBotClient</code> accepts an <code>IWebProxy</code> as a parameter in the constructor.</p>
<p>To use an HTTP proxy, the <code>WebProxy</code> class if what you will want to use.</p>
<pre><code class="language-csharp">using System.Net;

WebProxy httpProxy = new WebProxy(address, port)
{
    // Credentials if needed
    Credentials = new NetworkCredential(&quot;username&quot;, &quot;password&quot;)
};

TelegramBotClient Bot = new TelegramBotClient(&quot;API Token&quot;, httpProxy);
</code></pre>
<a class="header" href="#socks5-proxy" id="socks5-proxy"><h2>Socks5 Proxy</h2></a>
<p>There is no direct support for socks proxies in the .NET Standard.</p>
<p>You can use an external NuGet package: <a href="https://www.nuget.org/packages/HttpToSocks5Proxy/"><code>HttpToSocks5Proxy</code></a>.</p>
<pre><code class="language-csharp">using MihaZupan;

var proxy = new HttpToSocks5Proxy(Socks5ServerAddress, Socks5ServerPort);

// Or if you need credentials for your proxy server:
var proxy = new HttpToSocks5Proxy(Socks5ServerAddress, Socks5ServerPort, &quot;username&quot;, &quot;password&quot;);

// Allows you to use proxies that are only allowing connections to Telegram
// Needed for some proxies
proxy.ResolveHostnamesLocally = true;

TelegramBotClient Bot = new TelegramBotClient(&quot;API Token&quot;, proxy);
</code></pre>
<p>Example taken from <a href="https://github.com/MihaZupan/HttpToSocks5Proxy/blob/master/README.md#usage-with-telegrambot-library"><code>HttpToSocks5Proxy</code>'s readme</a>.</p>
<a class="header" href="#socks5-proxy-over-tor" id="socks5-proxy-over-tor"><h2>Socks5 proxy over Tor</h2></a>
<p><strong>Note: Do not use this in production as it has increased latency and abysmal bandwidth.</strong></p>
<p><em>Using this method, you can avoid restrictions in some countries.
It might be useful to developers for testing, before pushing new versions to hosting providers.</em></p>
<ol>
<li>Install <a href="https://www.torproject.org/">Tor Browser</a></li>
<li>Open the <code>torcc</code> file with a text editor (Found in <code>Tor Browser\Browser\TorBrowser\Data\Tor</code>)</li>
<li>Add the following lines:</li>
</ol>
<pre><code class="language-bash">EntryNodes {NL}
ExitNodes {NL}
StrictNodes 1
SocksPort 127.0.0.1:9050
</code></pre>
<ol start="4">
<li>Look at the <a href="#socks5-proxy">Socks5 proxy</a> example above.</li>
<li>Start the Tor Browser</li>
</ol>
<p>Usage:</p>
<pre><code class="language-csharp">using MihaZupan;
Bot = new TelegramBotClient(&quot;API Token&quot;, new HttpToSocks5Proxy(&quot;127.0.0.1&quot;, 9050));
</code></pre>
<p><em>Note that Tor has to be active at all times for the bot to work</em></p>
<blockquote>
<p>What do those lines in <code>torcc</code> do?</p>
</blockquote>
<pre><code class="language-bash">EntryNodes {NL}
ExitNodes {NL}
StrictNodes 1
</code></pre>
<p>These three lines make sure you use nodes from the Netherlands as much as possible to reduce latency.</p>
<p><code>SocksPort 127.0.0.1:9050</code></p>
<p>This line tells tor to listen on port 9050 for any socks connections.
You can change the port to anything you want (9050 is just the default), just make sure to use the same port in your code.</p>
<p>An authorization token (also refered to as: API token, access token, bot token, API key, etc.).</p>
<p>Generating one is very simple - of course, if you have read the <a href="https://core.telegram.org/bots">documentation</a> you already know that :)</p>
<p>Simply contact the <a href="https://telegram.me/botfather">@BotFather</a> and use the <code>/newbot</code> command.</p>
<p>The token should look like this: <code>123456:somerandomcharacters</code>. (numbers, a colon and 35 random characters)</p>
<p>The part before the colon is public (your bot ID).</p>
<p>Now that you have your token, <strong>do not share it!</strong> If you lose it, you can always revoke it and generate a new one with <a href="https://telegram.me/botfather">@BotFather</a>.</p>
<p>First, read the <a href="https://core.telegram.org/bots/api#sending-files">documentation on sending files</a>.</p>
<a class="header" href="#uploading-the-actual-file" id="uploading-the-actual-file"><h2>Uploading the actual file</h2></a>
<pre><code class="language-csharp">using (FileStream fs = System.IO.File.OpenRead(&quot;Local file.pdf&quot;))
{
    InputOnlineFile inputOnlineFile = new InputOnlineFile(fs, &quot;Name for the user.pdf&quot;);
    await Bot.SendDocumentAsync(message.Chat, inputOnlineFile);
}
</code></pre>
<a class="header" href="#uploading-by-file-id" id="uploading-by-file-id"><h2>Uploading by file id</h2></a>
<p>This is the method that you will want to use the most, as it is the most efficient.
After sending a file to the user, or receiving a file, you can send the file again using its ID.</p>
<p>This saves you from uploading the entire file.</p>
<pre><code class="language-csharp">InputOnlineFile inputOnlineFile = new InputOnlineFile(&quot;file id&quot;);
await Bot.SendDocumentAsync(message.Chat, inputOnlineFile);
</code></pre>
<a class="header" href="#uploading-by-url" id="uploading-by-url"><h2>Uploading by URL</h2></a>
<pre><code class="language-csharp">InputOnlineFile inputOnlineFile = new InputOnlineFile(&quot;telegram.org/img/t_logo.png&quot;);
await Bot.SendDocumentAsync(message.Chat, inputOnlineFile);
</code></pre>
<a class="header" href="#date-and-time" id="date-and-time"><h2>Date and Time</h2></a>
<p>All <code>DateTime</code> values are now in UTC format. Here are some examples of usage:</p>
<pre><code class="language-csharp">// Use UTC time when making a request
await BotClient.KickChatMemberAsync(
  chatId: -9876,
  userId: 1234,
  untilDate: DateTime.UtcNow.AddDays(2)
);
</code></pre>
<pre><code class="language-csharp">// Convert to local time (not recommended though)
DateTime localTime = update.Message.Date.ToLocalTime();
</code></pre>
<a class="header" href="#keyboard-buttons" id="keyboard-buttons"><h2>Keyboard Buttons</h2></a>
<p>Many keyboard button types are removed from project. It is more convenient to use factory methods on <code>KeyboardButton</code> and <code>InlineKeyboardButton</code> classes.</p>
<p>Here are some examples:</p>
<pre><code class="language-csharp">// Message having an inline keyboard button with URL that redirects to a page
await BotClient.SendTextMessageAsync(
  chatId: -9876,
  text: &quot;Check out the source code&quot;,
  replyMarkup: new InlineKeyboardMarkup(
    InlineKeyboardButton.WithUrl(&quot;Repository&quot;, &quot;https://github.com/TelegramBots/Telegram.Bot&quot;)
  )
);
</code></pre>
<pre><code class="language-csharp">// Message to a private chat having a 2-row reply keyboard
await BotClient.SendTextMessageAsync(
  chatId: 1234,
  text: &quot;Share your contact &amp; location&quot;,
  replyMarkup: new ReplyKeyboardMarkup(
    new [] { KeyboardButton.WithRequestContact(&quot;Share Contact&quot;) },
    new [] { KeyboardButton.WithRequestLocation(&quot;Share Location&quot;) },
  )
);
</code></pre>
<a class="header" href="#getfileasync" id="getfileasync"><h2><code>GetFileAsync()</code></h2></a>
<p>Downloading a file from Telegram Bot API has 2 steps (<a href="https://core.telegram.org/bots/api#getfile">see docs here</a>):</p>
<ol>
<li>Get file info by calling <code>getFile</code></li>
<li>Download file from <code>https://api.telegram.org/file/bot&lt;token&gt;/&lt;file_path&gt;</code></li>
</ol>
<p><code>GetFileAsync()</code> is replaced by 3 methods. Method <code>GetInfoAndDownloadFileAsync()</code> looks very similar to old <code>GetFileAsync()</code>:</p>
<pre><code class="language-csharp">// Gets file info and saves it to &quot;path/to/file.pdf&quot;
using (var fileStream = System.IO.File.OpenWrite(&quot;path/to/file.pdf&quot;))
{
  File fileInfo = await BotClient.GetInfoAndDownloadFileAsync(
    fileId: &quot;BsdfgLg4Khdlsn-bldBD&quot;,
    destination: fileStream
  );
}
</code></pre>
<blockquote>
<p>Note that calling the method <code>GetInfoAndDownloadFileAsync()</code> results in 2 HTTP requests (steps 1 and 2 above) being sent to the Bot API.</p>
</blockquote>
<p>There are two more methods that assist you with downloading files:</p>
<pre><code class="language-csharp">// New version of GetFileAsync() only gets the file info (step 1)
File fileInfo = await BotClient.GetFileAsync(&quot;BsdfgLg4Khdlsn-bldBD&quot;);

// Download file from server (step 2)
using (var fileStream = System.IO.File.OpenWrite(&quot;path/to/file.pdf&quot;)) {
  await BotClient.DownloadFileAsync(
    filePath: fileInfo.FilePath,
    destination: fileStream
  );
}
</code></pre>
<a class="header" href="#getupdatesasync-setwebhookasync" id="getupdatesasync-setwebhookasync"><h2><code>GetUpdatesAsync()</code>, <code>SetWebhookAsync()</code></h2></a>
<p>Value <code>All</code> is removed from enum <code>Telegram.Bot.Types.Enums.UpdateType</code>. In order to get all kind of updates, pass an empty list such as <code>new UpdateType[0]</code> for <code>allowedUpdates</code> argument.</p>
<a class="header" href="#setwebhookasync" id="setwebhookasync"><h2><code>SetWebhookAsync()</code></h2></a>
<p>Parameter <code>url</code> is required. If you intend to remove the webhook, it is recommended to use <code>DeleteWebhookAsync()</code> instead. However, you could achieve the same result by passing <code>string.Empty</code> value to <code>url</code> argument.</p>
<a class="header" href="#answerinlinequeryasync-and-inlinequeryresult" id="answerinlinequeryasync-and-inlinequeryresult"><h2><code>AnswerInlineQueryAsync()</code> and <code>InlineQueryResult</code></h2></a>
<p>Classes <code>InlineQueryResultNew</code> and <code>InlineQueryResultCache</code> are removed. <code>InlineQueryResult</code> has become the only shared base type for all inline query result classes.</p>
<p>Many shared and redundant properties are removed. This might require significant changes to your <code>.cs</code> files if your bot is in <em>inline mode</em>. Fortunately, all input query results now have constructors with only the required properties as their parameters. This is the preferred way to instantiate input query result instances e.g.:</p>
<p>Instead of:</p>
<pre><code class="language-csharp">// bad way. easy to get exceptions
documentResult = new InlineQueryResultDocument
{
  Id = &quot;some-id&quot;,
  Url = &quot;https://example.com/document.pdf&quot;,
  Title = &quot;Some title&quot;,
  MimeType = &quot;application/pdf&quot;
};
</code></pre>
<p>You should use:</p>
<pre><code class="language-csharp">// good way
documentResult = new InlineQueryResultDocument(
  id: &quot;some-id&quot;,
  documentUrl: &quot;https://example.com/document.pdf&quot;,
  title: &quot;Some title&quot;,
  mimeType: &quot;application/pdf&quot;
);
</code></pre>
<a class="header" href="#sendmediagroupasync" id="sendmediagroupasync"><h2><code>SendMediaGroupAsync()</code></h2></a>
<p><code>InputMediaType</code> is renamed to <code>InputMedia</code>.</p>
<blockquote>
<p><em>ToDo</em></p>
</blockquote>
<a class="header" href="#inline-message-overloads" id="inline-message-overloads"><h2>Inline Message Overloads</h2></a>
<p>Many inline message methods have been replaced with their overloads.</p>
<ul>
<li><code>EditInlineMessageTextAsync</code>--&gt; <code>EditMessageTextAsync</code></li>
</ul>
<blockquote>
<p><em>ToDo</em></p>
</blockquote>
<a class="header" href="#filetosend" id="filetosend"><h2><code>FileToSend</code></h2></a>
<p>New classes have replaced <code>FileToSend</code> struct.</p>
<ul>
<li><code>InputFileStream</code>:</li>
<li><code>InputTelegramFile</code>:</li>
<li><code>InputOnlineFile</code>:</li>
</ul>
<p>In many cases, you can use implicit casting to pass parameters.</p>
<pre><code class="language-csharp">Stream stream = System.IO.File.OpenRead(&quot;photo.png&quot;);
message = await BotClient.SendPhotoAsync(&quot;chat id&quot;, stream);

string fileId = &quot;file_id on Telegram servers&quot;;
message = await BotClient.SendPhotoAsync(&quot;chat id&quot;, fileId);
</code></pre>
<blockquote>
<p><em>ToDo</em>. implicit casts</p>
</blockquote>
<a class="header" href="#updatetype-and-messagetype" id="updatetype-and-messagetype"><h2><code>UpdateType</code> and <code>MessageType</code></h2></a>
<p>Values in these two enums are renamed e.g. <code>UpdateType.MessageUpdate</code> is now <code>UpdateType.Message</code>.</p>
<p><code>MessageType.Service</code> is removed. Now each type of message has its own <code>MessageType</code> value e.g. when a chat member leaves a group, corresponding update contains a message type of <code>MessageType.ChatMemberLeft</code> value.</p>
<a class="header" href="#videonote" id="videonote"><h2><code>VideoNote</code></h2></a>
<p>Properties <code>Width</code> and <code>Height</code> are removed. Vide notes are squared and <code>Length</code> property represents both width and height.</p>
<a class="header" href="#constructor-parameters-instead-of-public-setters" id="constructor-parameters-instead-of-public-setters"><h2>Constructor Parameters Instead of Public Setters</h2></a>
<p>Many types now have the required parameters in their constructors. To avoid running into problems or getting exceptions, we recommend providing all required values in the constructor e.g.:</p>
<pre><code class="language-c#">//bad way:
markup = new InlineKeyboardMarkup {
  Keyboard = buttonsArray,
  ResizeKeyboard = true
};

// better:
markup = new InlineKeyboardMarkup(buttonsArray) {
  ResizeKeyboard = true
};
</code></pre>
<a class="header" href="#polling" id="polling"><h2>Polling</h2></a>
<a class="header" href="#webhook" id="webhook"><h2>WebHook</h2></a>
<p><strong>This guide assumes prior knowledge of the C# programming language.</strong></p>
<p>Let's create a simple bot, that responds with &quot;Hello&quot; to any message it receives.</p>
<p>Operating such a bot is a two-step process:</p>
<ol>
<li>Wait for a message from a user</li>
<li>Send a response</li>
</ol>
<p>Step one is what we call <code>Getting updates</code>, and is more thoroughly described <a href="Getting-Updates.html">here</a>.</p>
<a class="header" href="#lets-get-coding" id="lets-get-coding"><h3>Let's get coding</h3></a>
<p>We will be working with a Console project.</p>
<p>First things first, reference the <code>Telegram.Bot</code> <a href="https://www.nuget.org/packages/Telegram.Bot/">NuGet package</a>.</p>
<p>And add some using statements:</p>
<pre><code class="language-csharp">using Telegram.Bot;             // TelegramBotClient
using Telegram.Bot.Args;        // MessageEventArgs
using Telegram.Bot.Types;       // Message
using Telegram.Bot.Types.Enums; // MessageType
</code></pre>
<p>Now let's create an instance of the <code>TelegramBotClient</code>, that we will be using.</p>
<pre><code class="language-csharp">static readonly TelegramBotClient Bot = new TelegramBotClient(&quot;API Token&quot;);
</code></pre>
<p>The library provides a simple system for getting new updates as events.</p>
<p>To use it, subscribe to the <code>OnMessage</code> event and create the callback method.
We must also call <code>StartReceiving</code> to actually start the process.</p>
<pre><code class="language-csharp">Bot.OnMessage += Bot_OnMessage;
Bot.StartReceiving();
</code></pre>
<p>This method will be called any time a user sends the bot a message (be it text, images, video ...).</p>
<p>The <code>MessageEventArgs</code> contain the <code>Message</code> object, that is important to us.
We only want to respond when the user sends us text, so we'll check that the message is of type <code>Text</code>.</p>
<pre><code class="language-csharp">private static async void Bot_OnMessage(object sender, MessageEventArgs e)
{
    Message message = e.Message;

    if (message.Type == MessageType.Text)
    {

    }
}
</code></pre>
<p>Note the <code>async</code> modifier. All methods in <code>TelegramBotClient</code> are async.
To send a message we will use the <code>SendTextMessageAsync</code> method.</p>
<p>The method accepts two main parameters: chat and text.</p>
<p><code>Chat</code> is the id of the chat, that you want to send the message to.
We will send it to the same chat we got the message from (<code>message.Chat</code>).</p>
<p>The text will, of course, be &quot;Hello&quot;.</p>
<pre><code class="language-csharp">await Bot.SendTextMessageAsync(message.Chat, &quot;Hello&quot;);
</code></pre>
<a class="header" href="#that-is-it" id="that-is-it"><h3>That is it!</h3></a>
<p>The entire code should now look something like <a href="https://gist.github.com/MihaZupan/c5076b06c5b73cbc3b0f71cc6e6b4709">this</a>.</p>
<p>Now all that is left is to start the bot up.</p>
<p>You can do it on your computer if you want, but you should also take a look at <a href="Deploying-Your-Bot.html">other deployment options</a>.</p>
<p>There are multiple ways to look for examples:</p>
<ul>
<li>Based on the API method you are looking for:
<ul>
<li>Search for references to it</li>
<li>or filter test methods based on that trait</li>
</ul>
</li>
</ul>
<a class="header" href="#integration-tests" id="integration-tests"><h1>Integration Tests</h1></a>
<p>Integration tests are meant to test the project with real data from Telegram. They are semi-automated tests and tester(s) need to interact with bot for some cases during the test execution. Tests could be used as a playground for exploring Bot API methods.</p>
<a class="header" href="#sample-test-diagnostics-output" id="sample-test-diagnostics-output"><h2>Sample Test Diagnostics Output</h2></a>
<p>All the test output goes into the supergroup/private chats specified in configurations or interactively during test execution. You can see some samples of test output below.</p>
<p>Admin bots can change chat photo.</p>
<p><img src="https://raw.githubusercontent.com/TelegramBots/telegram.bot/develop/docs/wikis/tests/images/testcase-chatphoto.jpg" alt="Test Case: Set Chat Photo" /></p>
<p>Invoices could be paid in private chats.</p>
<p><img src="https://raw.githubusercontent.com/TelegramBots/telegram.bot/develop/docs/wikis/tests/images/testcase-payment.jpg" alt="Test Case: Set Chat Photo" /></p>
<a class="header" href="#how-tests-works" id="how-tests-works"><h2>How Tests Works</h2></a>
<p>These integration tests are written just like regular unit tests with xUnit framework so they seem to be unit tests. When you run test(s), bot makes a request to Bot API and you should see results(message or service notification) in the chat with bot.</p>
<p>When you build the solution, you will see them in Test Explorer window. Tests could be run through .NET Core's CLI as well and that's how this project's CI is set up.</p>
<p>A bot, of course, is needed to test Bot API. This document refers to its user name as <em>MyTestBot</em>.</p>
<p><em>Tester</em> refers to user name of person testing the bot. Multiple testers could interact with bot during
test execution. If super group chat has other members that are not listed as testers, bot ignores their
messages during test execution. Testers must have user names assigned and their user names should be set
in test configurations before hand.</p>
<p>All the tests happen in two chats. A Super Group chat and a Private chat with one of the testers.</p>
<p>Test cases that need tester's interaction to continue, have a limit of usually 2 minues to wait for receving an expected update from API.</p>
<p>Tests could be run individually, in collections, or all at once. All the test collection and test cases whithin them are ordered and tests will not run in parallel.</p>
<a class="header" href="#test-environment-setup" id="test-environment-setup"><h2>Test Environment Setup</h2></a>
<p>Create a Super Group and add bot to it. Promote bot to admin and make sure it has all the permissions. This group needs to have another regular(non-admin) member to be used in tests for chat administration methods(such as Kick, Restrict, Unban). A super group with 2 testers in it, one admin and the other non-admin member, is enough.</p>
<p>Bot should have some features enabled, usually through BotFather, in order to pass tests. These features are listed below:</p>
<ul>
<li>Inline Queries</li>
<li>Payment Provider</li>
</ul>
<p>For making testing process more convenient, set the following commands for MyTestBot as well. The purpose for these commands is explained in the sections below.</p>
<pre><code class="language-text">test - Start test execution
  me - Select me for testing admin methods
</code></pre>
<a class="header" href="#test-configurations" id="test-configurations"><h2>Test Configurations</h2></a>
<p>You can see a list of configuration keys in <code>appsettings.json</code> file. Make a copy of this file and store your configurations there. In addition to <code>appsettings.json</code> and <code>appsettings.Development.json</code>, environment variables prefixed by <code>TelegramBot_</code> are also read into program.</p>
<pre><code class="language-bash">cp appsettings.json appsettings.Development.json
</code></pre>
<a class="header" href="#required-settings" id="required-settings"><h3>Required Settings</h3></a>
<p>Only 2 values must be provided before test execution.</p>
<a class="header" href="#api-token" id="api-token"><h4>API Token</h4></a>
<p>This is required for executing any test case.</p>
<pre><code class="language-json">{
    &quot;ApiToken&quot;: &quot;MyTestBot-API-TOKEN&quot;
    /* ... */
}
</code></pre>
<a class="header" href="#allowed-users" id="allowed-users"><h4>Allowed Users</h4></a>
<p>A comma separated list indicating user name(s) of tester(s). Any update coming from users other than the ones listed here are discarded during test execution.</p>
<pre><code class="language-json">{
    /* ... */
    &quot;AllowedUserNames&quot;: &quot;tester1, Tester2, TESTER3&quot;
    /* ... */
}
</code></pre>
<a class="header" href="#optional-settings" id="optional-settings"><h3>Optional Settings</h3></a>
<p>The following settings are not required for two reasons. Either bot can ask for them during test execution or it is not a required setting for all test cases.</p>
<p>Bot will ask testers in supergroup/private chat for the necessary information. It would be faster to set all the optional settings as well because it makes testing process faster and less manual.</p>
<blockquote>
<p>For obtaining values of necessary settings, you can set breakpoints in some test methods and extract values such as chat id or user id.</p>
</blockquote>
<a class="header" href="#supergroup-chat-id" id="supergroup-chat-id"><h4>Supergroup Chat Id</h4></a>
<p>Bot send  messages to this chat in almost all test cases except cases like sending payments that must be to a private chat.</p>
<p>If not set, before starting any test method, bot waits for a tester to send it a <code>/test</code> command in a super group chat (that bot is also a member of).</p>
<pre><code class="language-json">{
    /* ... */
    &quot;SuperGroupChatId&quot;: -1234567890
    /* ... */
}
</code></pre>
<a class="header" href="#payment-settings" id="payment-settings"><h4>Payment Settings</h4></a>
<a class="header" href="#required-payment-provider-token" id="required-payment-provider-token"><h5>[Required] Payment Provider Token</h5></a>
<p>This token is <strong>required</strong> for any test case regarding payments and must be provided before starting tests.</p>
<p>Consult Telegram API documentations and talk to BotFather to get a test token from a payment provider.</p>
<pre><code class="language-json">{
    /* ... */
    &quot;PaymentProviderToken&quot;: &quot;MY-PAYMENT-PROVIDER-TOKEN&quot;
    /* ... */
}
</code></pre>
<a class="header" href="#testerprivatechatid" id="testerprivatechatid"><h5>TesterPrivateChatId</h5></a>
<p>Invoices could only be sent to private chats. If not set, bot will wait for a tester to send it <code>/test</code> command in a private chat.</p>
<pre><code class="language-json">{
    /* ... */
    &quot;TesterPrivateChatId&quot;: 1234567890
    /* ... */
}
</code></pre>
<a class="header" href="#chat-administration" id="chat-administration"><h4>Chat Administration</h4></a>
<p>For this type of tests, bot should be a priviledged admin of that super group. Methods such as kick or unban will be performed on a regular (non-admin) tester in that chat.</p>
<p>If the following 3 settings are not set, bot will ask a tester to send it <code>/me</code> command in a private chat with bot.</p>
<ul>
<li>Regular Member's User Id</li>
<li>Regular Member's User Name</li>
<li>Regular Member's Private Chat Id</li>
</ul>
<pre><code class="language-json">{
    /* ... */
    &quot;RegularMemberUserId&quot;: 1234567890,
    &quot;RegularMemberUserName&quot;: &quot;tester3&quot;,
    &quot;RegularMemberPrivateChatId&quot;: 1234567890
    /* ... */
}
</code></pre>
<p>Everything related to the <a href="https://core.telegram.org/widgets/login">Telegram Login Widget</a> has been moved to a separate repository:
<a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.LoginWidget"><code>Telegram.Bot.Extensions.LoginWidget</code></a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
