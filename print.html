<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Telegram Bots in .NET</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><a href="quickstart.html"><strong aria-hidden="true">2.</strong> Quickstart</a></li><li><a href="example-bot.html"><strong aria-hidden="true">3.</strong> Example</a></li><li><a href="send-msg/index.html"><strong aria-hidden="true">4.</strong> Sending Messages</a></li><li><ol class="section"><li><a href="send-msg/text-msg.html"><strong aria-hidden="true">4.1.</strong> Text Messages</a></li><li><a href="send-msg/multimedia-msg.html"><strong aria-hidden="true">4.2.</strong> Multimedia Message</a></li></ol></li><li><a href="proxy.html"><strong aria-hidden="true">5.</strong> HTTP/SOCKS5 Proxy</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Telegram Bots in .NET</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#introduction" id="introduction"><h1>Introduction</h1></a>
<p><a href="https://github.com/TelegramBots/Telegram.Bot"><strong>Telegram.Bot</strong></a> is the most popular .NET Client for <a href="https://core.telegram.org/bots/api">Telegram Bot API</a>. The Bot API is an HTTP-based interface created
for developers keen on building bots for Telegram.</p>
<p>Check <a href="https://core.telegram.org/bots"><em>Bots: An introduction for developers</em></a> to understand what a Telegram bot is and what it can do.</p>
<p>We, <a href="https://github.com/orgs/TelegramBots/people">Telegram Bots team</a>, mainly focus on developing multiple <a href="https://www.nuget.org/profiles/TelegramBots">NuGet packages</a> for creating chat bots.</p>
<table><thead><tr><th align="center">Packages</th><th align="center">Team</th><th align="center">News Channel</th><th align="center">Group Chat</th></tr></thead><tbody>
<tr><td align="center"> <a href="https://www.nuget.org/profiles/TelegramBots"><img src="docs/intro-nuget-logo.png" alt="Packages" /></a> </td><td align="center"> <a href="https://github.com/orgs/TelegramBots/people"><img src="docs/intro-gh-logo.png" alt="Team" /></a> </td><td align="center"> <a href="https://t.me/tgbots_dotnet"><img src="docs/intro-channel-logo.jpg" alt="News Channel" /></a> </td><td align="center"> <a href="https://t.me/joinchat/B35YY0QbLfd034CFnvCtCA"><img src="docs/intro-chat-logo.jpg" alt="Group Chat" /></a> </td></tr>
<tr><td align="center"> Packages we release on NuGet </td><td align="center"> The team contributing to this work </td><td align="center"> Subscribe to <a href="https://t.me/tgbots_dotnet"><code>@tgbots_dotnet</code></a> channel to get our latest news </td><td align="center"> <a href="https://t.me/joinchat/B35YY0QbLfd034CFnvCtCA">Join our chat</a> to talk about bots and ask questions </td></tr>
</tbody></table>
<a class="header" href="#what-is-this-book-for" id="what-is-this-book-for"><h2>What Is This Book For</h2></a>
<p>All Bot API methods are already documented by Telegram<sup class="footnote-reference"><a href="#1">1</a></sup> but this book covers all you need to create a chat bot in
.NET and there are many concrete examples written in C#. The guides here can even be useful to bot developers in other
languages/platforms as it shows best practices in developing Telegram chat bots with examples.</p>
<a class="header" href="#correctness" id="correctness"><h2>Correctness</h2></a>
<p>This project is fully tested using Unit tests and Systems Integration tests before each release. In fact, our test cases
are self-documenting and serve as examples for Bot API methods. Once you learn the basics of Telegram chat bots, you
will be able to easily copy test methods to your own program and make your bot smarter.</p>
<a class="header" href="#get-started" id="get-started"><h2>Get Started</h2></a>
<p><strong>Begin your bot development journey from <a href="quickstart.html"><em>Quickstart</em></a> guide.</strong></p>
<hr />
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://core.telegram.org/bots/api">Telegram Bot API</a></p>
</div>
<a class="header" href="#quickstart" id="quickstart"><h1>Quickstart</h1></a>
<a class="header" href="#bot-father" id="bot-father"><h2>Bot Father</h2></a>
<p>Before you start developing a bot, you need to talk to <a href="https://t.me/botfather"><code>@BotFather</code></a> on Telegram. Register a
bot with him and get an access token.</p>
<p><a href="https://t.me/botfather"><img src="./docs/bot-father.jpg" alt="Bot Father" /></a></p>
<p>Access token is a key used to identify and authorize your bot in API
requests so keep it with yourself as a secret. It looks like this:</p>
<pre><code class="language-text">123456789:AAE5cvFhxQ9C7vFGElcpMTNrYrkl3OBFo45
</code></pre>
<a class="header" href="#hello-world" id="hello-world"><h2>Hello World</h2></a>
<p>Now you have a bot, it's time to bring it to life! Create a new console project for your bot. It could be a .NET Core project or a .NET project targeting versions 4.5+.</p>
<blockquote>
<p>This guide uses .NET Core examples but full .NET framework projects work as well.</p>
</blockquote>
<pre><code class="language-bash">dotnet new console
</code></pre>
<p>Add a reference to <code>Telegram.Bot</code> package.</p>
<pre><code class="language-bash">dotnet add package Telegram.Bot
</code></pre>
<p>Open <code>Program.cs</code> file and use the following content. This code fetches Bot information based on its access token by calling <a href="https://core.telegram.org/bots/api#getme"><code>getMe</code></a> method on the Bot API.</p>
<blockquote>
<p>Replace <code>YOUR_ACCESS_TOKEN_HERE</code> with the access token from Bot Father.</p>
</blockquote>
<pre><code class="language-c#">using System;
using Telegram.Bot;

namespace Awesome {
  class Program {
    static void Main() {
      var botClient = new TelegramBotClient(&quot;YOUR_ACCESS_TOKEN_HERE&quot;);
      var me = botClient.GetMeAsync().Result;
      Console.WriteLine(
        $&quot;Hello, World! I am user {me.Id} and my name is {me.FirstName}.&quot;
      );
    }
  }
}
</code></pre>
<p>Running the program gives you the following output:</p>
<pre><code class="language-bash">dotnet run
</code></pre>
<pre><code class="language-text">Hello, World! I am user 123456789 and my name is Awesome Bot.
</code></pre>
<p>Great! This bot is self-aware. To make the bot interact with user, head to the next page.</p>
<a class="header" href="#example" id="example"><h1>Example</h1></a>
<p>On previous page, we got an access token and used <a href="https://core.telegram.org/bots/api#getme"><code>getMe</code></a> method to check our setup.
Now, it is time to make an <em>interactive</em> bot that gets user's messages and replies to them like in this screenshot:</p>
<p><img src="docs/shot-example_bot.jpg" alt="Example Image" /></p>
<p>Copy the following code to <code>Program.cs</code> file.</p>
<blockquote>
<p>Replace <code>YOUR_ACCESS_TOKEN_HERE</code> with the access token from Bot Father.</p>
</blockquote>
<pre><code class="language-c#">using System;
using System.Threading;
using Telegram.Bot;
using Telegram.Bot.Args;

namespace Awesome {
  class Program {
    static ITelegramBotClient botClient;

    static void Main() {
      botClient = new TelegramBotClient(&quot;YOUR_ACCESS_TOKEN_HERE&quot;);

      var me = botClient.GetMeAsync().Result;
      Console.WriteLine(
        $&quot;Hello, World! I am user {me.Id} and my name is {me.FirstName}.&quot;
      );

      botClient.OnMessage += Bot_OnMessage;
      botClient.StartReceiving();
      Thread.Sleep(999000);
    }

    static async void Bot_OnMessage(object sender, MessageEventArgs e) {
      if (e.Message.Text != null)
      {
        await botClient.SendTextMessageAsync(
          chatId: e.Message.Chat,
          text:   &quot;You said:\n&quot; + e.Message.Text
        );
      }
    }
  }
}
</code></pre>
<p>When you run this program via <code>dotnet run</code>, it runs forever(until forcefully stopped) waiting for
text messages. Open the chat with your bot in Telegram and send a text message to it. Bot should
reply in no time.</p>
<p>We subscribe to <code>OnMessage</code> event on bot client to take action on messages that users send to the bot.</p>
<p>By invoking <code>StartReceiving()</code>, bot client starts fetching updates(<a href="https://core.telegram.org/bots/api#getupdates"><code>getUpdates</code></a> method) for the bot
from Telegram Servers. This is an asynchronous operation so <code>Thread.Sleep()</code> is used right after that
to keep the app running for a while in this demo.</p>
<p>When user sends a message, <code>Bot_OnMessage()</code> is invoked with the message object in the event argument.
We are expecting a text message so we check for <code>Message.Text</code> value. Finally, we send a text message
back to the same chat that we received the message in.</p>
<a class="header" href="#sending-messages" id="sending-messages"><h1>Sending Messages</h1></a>
<ul>
<li><a href="text-msg.html">Send Text Messages (text and more)</a></li>
<li><a href="multimedia-msg.html">Send Multimedia Messages (photo, sticker, etc.)</a></li>
</ul>
<p>There are many different types of message that a bot can send. Fortunately, methods for sending such messages have are
similar. Take a look at these examples:</p>
<p><strong>Sending text message</strong>:</p>
<p><img src="../docs/shot-text_msg.jpg" alt="text message screenshot" /></p>
<pre><code class="language-c#">await botClient.SendTextMessageAsync(
  chatId: e.Message.Chat,
  text:   &quot;Hello, World!&quot;
);
</code></pre>
<p><strong>Sending sticker message</strong>:</p>
<p><img src="../docs/shot-sticker.jpg" alt="sticker message screenshot" /></p>
<pre><code class="language-c#">await botClient.SendStickerAsync(
  chatId:  e.Message.Chat,
  sticker: &quot;https://github.com/TelegramBots/book/raw/master/src/docs/sticker-dali.webp&quot;
);
</code></pre>
<p><strong>Sending video message</strong>:</p>
<p><img src="../docs/shot-video.jpg" alt="video message screenshot" /></p>
<pre><code class="language-c#">await botClient.SendVideAsync(
  chatId:  e.Message.Chat,
  video: &quot;https://github.com/TelegramBots/book/raw/master/src/docs/video-bulb.mp4&quot;
);
</code></pre>
<a class="header" href="#text-messages" id="text-messages"><h1>Text Messages</h1></a>
<a class="header" href="#multimedia-message" id="multimedia-message"><h1>Multimedia Message</h1></a>
<a class="header" href="#working-behind-a-proxy" id="working-behind-a-proxy"><h1>Working Behind a Proxy</h1></a>
<p>Telegram bot client allows you to use a proxy for Bot API connections. There are 3 solutions offered in this guide:</p>
<ul>
<li><a href="#http-proxy">HTTP Proxy</a></li>
<li><a href="#socks5-proxy">SOCKS5 Proxy</a></li>
<li><a href="#socks5-proxy-over-tor">SOCKS5 Proxy over Tor (Testing Only)</a></li>
</ul>
<p><img src="./docs/tg-network.gif" alt="Telegram Network" /></p>
<blockquote>
<p>If you are in a country, such as Iran, where HTTP and SOCKS proxy connections to Telegram servers are blocked, consider using a VPN, using Tor Network, or hosting your bot in other jurisdictions.</p>
</blockquote>
<a class="header" href="#http-proxy" id="http-proxy"><h2>HTTP Proxy</h2></a>
<p>You can pass an <code>IWebProxy</code> to bot client for HTTP Proxy.</p>
<pre><code class="language-csharp">// using System.Net;

var httpProxy = new WebProxy(address: &quot;https://example.org&quot;, port: 8080) {
  // Credentials if needed:
  Credentials = new NetworkCredential(&quot;USERNMAE&quot;, &quot;PASSWORD&quot;)
};
var botClient = new TelegramBotClient(&quot;YOUR_API_TOKEN&quot;, httpProxy);
</code></pre>
<a class="header" href="#socks5-proxy" id="socks5-proxy"><h2>SOCKS5 Proxy</h2></a>
<p>Unfortunately, there is no built-in support for socks proxies in the .NET Standard libraries.
You can use an external NuGet package: <a href="https://www.nuget.org/packages/HttpToSocks5Proxy/"><code>HttpToSocks5Proxy</code></a> provided by one of our team members.</p>
<pre><code class="language-csharp">// using MihaZupan;

var proxy = new HttpToSocks5Proxy(Socks5ServerAddress, Socks5ServerPort);

// Or if you need credentials for your proxy server:
var proxy = new HttpToSocks5Proxy(
  Socks5ServerAddress, Socks5ServerPort, &quot;USERNAME&quot;, &quot;PASSWORD&quot;
);

// Allows you to use proxies that are only allowing connections to Telegram
// Needed for some proxies
proxy.ResolveHostnamesLocally = true;

var botClient = new TelegramBotClient(&quot;YOUR_API_TOKEN&quot;, proxy);
</code></pre>
<p>You can see other usages of this package at <a href="https://github.com/MihaZupan/HttpToSocks5Proxy/blob/master/README.md#usage-with-telegrambot-library"><code>HttpToSocks5Proxy</code>'s readme</a>.</p>
<a class="header" href="#socks5-proxy-over-tor" id="socks5-proxy-over-tor"><h2>SOCKS5 Proxy over Tor</h2></a>
<p><strong>Warning: Use for Testing only!</strong></p>
<blockquote>
<p>Do not use this method in a production deployment as it has high network latency and poor bandwidth.</p>
</blockquote>
<p>Using proxy with Tor, a developer can avoid network restrictions while debugging and testing the code
before a production release.</p>
<ol>
<li>Install <a href="https://www.torproject.org/">Tor Browser</a></li>
<li>Open the <code>torcc</code> file with a text editor (Found in <code>Tor Browser\Browser\TorBrowser\Data\Tor</code>)</li>
<li>Add the following lines: (configurations are described below)
<pre><code class="language-bash">EntryNodes {NL}
ExitNodes {NL}
StrictNodes 1
SocksPort 127.0.0.1:9050
</code></pre>
</li>
<li>Look at the <a href="#socks5-proxy">Socks5 proxy</a> example above.</li>
<li>Start the Tor Browser</li>
</ol>
<p>Usage:</p>
<pre><code class="language-csharp">// using MihaZupan;

var botClient = new TelegramBotClient(
  &quot;YOUR_API_TOKEN&quot;,
  new HttpToSocks5Proxy(&quot;127.0.0.1&quot;, 9050)
);
</code></pre>
<blockquote>
<p>Note that Tor has to be active at all times for the bot to work.</p>
</blockquote>
<a class="header" href="#configurations-in-torcc" id="configurations-in-torcc"><h3>Configurations in <code>torcc</code></h3></a>
<pre><code class="language-bash">EntryNodes {NL}
ExitNodes {NL}
StrictNodes 1
</code></pre>
<p>These three lines make sure you use nodes from the Netherlands as much as possible to reduce latency.</p>
<p><code>SocksPort 127.0.0.1:9050</code></p>
<p>This line tells tor to listen on port 9050 for any socks connections.
You can change the port to anything you want (9050 is just the default), just make sure to use the same port in your code.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
